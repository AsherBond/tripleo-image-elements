## NB: Unpolished config file
## This config file was taken directly from the upstream repo, and tweaked just enough to work.
## It has not been audited to ensure that everything present is either Heat controlled or a mandatory as-is setting.
## Please submit patches for any setting that should be deleted or Heat-configurable.
##  https://github.com/stackforge/diskimage-builder

[DEFAULT]
debug = True

s3_host={{keystone.host}}
ec2_host={{keystone.host}}
ec2_dmz_host={{keystone.host}}
ec2_url=http://{{nova.host}}:8773/services/Cloud
rabbit_host={{rabbit.host}}
cc_host={{keystone.host}}
nova_url=http://{{nova.host}}:8774/v1.1/

log_config=/etc/nova/logging.conf

sql_connection={{nova.db}}

logdir=/var/log/nova
state_path=/var/lib/nova
lock_path=/var/lib/nova
keys_path=/var/lib/nova/keys

api_paste_config=/etc/nova/api-paste.ini
verbose=True

# Auth
use_deprecated_auth=false
auth_strategy=keystone
keystone_ec2_url=http://{{keystone.host}}:5000/v2.0/ec2tokens
# Imaging service
glance_api_servers={{glance.host}}:9292
image_service=nova.image.glance.GlanceImageService

# Vnc configuration
novnc_enabled=true
novncproxy_base_url=http://{{nova.host}}:6080/vnc_auto.html
novncproxy_port=6080
vncserver_proxyclient_address=127.0.0.1
vncserver_listen=0.0.0.0

# Networking #
network_api_class=nova.network.quantumv2.api.API
quantum_url=http://{{quantum.host}}:9696
quantum_auth_strategy=keystone
quantum_admin_tenant_name=service
quantum_admin_username=quantum
quantum_admin_password={{service-password}}
quantum_admin_auth_url=http://{{keystone.host}}:35357/v2.0
libvirt_vif_driver=nova.virt.libvirt.vif.LibvirtHybridOVSBridgeDriver
linuxnet_interface_driver=nova.network.linux_net.LinuxOVSInterfaceDriver
fixed_range = 192.0.2.32/29
{{#quantum}}
service_quantum_metadata_proxy=true
quantum_metadata_proxy_shared_secret={{metadata_proxy_shared_secret}}
{{/quantum}}

dhcpbridge_flagfile=/etc/nova/nova.conf
dhcpbridge=/usr/bin/nova-dhcpbridge

rootwrap_config=/etc/nova/rootwrap.conf
security_group_api=quantum
firewall_driver=nova.virt.firewall.NoopFirewallDriver

# Cinder #
volume_api_class=nova.volume.cinder.API
osapi_volume_listen_port=5900

rabbit_host={{rabbit.host}}
rabbit_password={{rabbit.password}}

enabled_apis = ec2,osapi_compute,metadata,openstack_compute_api_v2

dhcpbridge_flagfile = /etc/nova/nova.conf
dhcpbridge=/usr/local/bin/nova-dhcpbridge

compute_driver = {{nova.compute_driver}}

{{#nova.tuning}}
ram_allocation_ratio = {{ram_allocation_ratio}}
reserved_host_memory_mb = {{reserved_host_memory_mb}}
{{/nova.tuning}}

{{#nova.baremetal}}
scheduler_host_manager = nova.scheduler.baremetal_host_manager.BaremetalHostManager
firewall_driver = nova.virt.firewall.NoopFirewallDriver

[baremetal]
sql_connection = {{db}}
net_config_template = /opt/stack/nova/nova/virt/baremetal/net-static.ubuntu.template
tftp_root = /tftpboot
instance_type_extra_specs = cpu_arch:{{arch}}

driver = nova.virt.baremetal.pxe.PXE
power_manager = {{power_manager}}
{{#virtual_power}}
virtual_power_host_user={{user}}
virtual_power_host_key={{key}}
virtual_power_ssh_host={{ssh_host}}
virtual_power_type={{type}}
{{/virtual_power}}
{{/nova.baremetal}}
